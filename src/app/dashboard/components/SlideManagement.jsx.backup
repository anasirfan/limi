'use client';

import React, { useState, useEffect, useMemo, useCallback } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { FaPlus, FaTrash, FaEdit, FaArrowUp, FaArrowDown, FaImage, FaVideo, FaColumns, FaLayerGroup } from 'react-icons/fa';
import SlideEditor from '../../components/SlideCarousel/SlideEditor';
import SlideCarousel from '../../components/SlideCarousel';
import Image from 'next/image';
import { 
  addSlide, 
  removeSlide, 
  updateSlide, 
  reorderSlides, 
  setActiveSlideIndex 
} from '../../redux/slices/slidesSlice';

// No longer using react-beautiful-dnd, using manual reordering instead

export default function SlideManagement() {
  const dispatch = useDispatch();
  const { slides, activeSlideIndex } = useSelector(state => state.slides);
  const [previewMode, setPreviewMode] = useState(false);
  const [editMode, setEditMode] = useState(true);
  const [editModalOpen, setEditModalOpen] = useState(false);
  const [editingSlide, setEditingSlide] = useState(null);
  
  // Local state for form values to ensure real-time UI updates
  const [formState, setFormState] = useState({
    layout: '',
    media: { type: 'image', position: 'left', urls: [''] },
    text: { 
      heading: '', 
      subheading: '', 
      description: '', 
      bullets: [],
      alignment: 'left',
      verticalPosition: 'center',
      showHeading: true, 
      showSubheading: true, 
      showDescription: true, 
      showBullets: false 
    },
    appearance: { 
      theme: 'charleston', 
      backgroundColor: '#292929', 
      overlayDarken: false,
      padding: '2rem' 
    }
  });
  
  // Update formState when editingSlide changes
  useEffect(() => {
    if (editingSlide) {
      setFormState({
        layout: editingSlide.layout || '',
        media: {
          type: editingSlide.media?.type || 'image',
          position: editingSlide.media?.position || 'left',
          urls: [...(editingSlide.media?.urls || [''])],
        },
        text: {
          heading: editingSlide.text?.heading || '',
          subheading: editingSlide.text?.subheading || '',
          description: editingSlide.text?.description || '',
          bullets: [...(editingSlide.text?.bullets || [])],
          alignment: editingSlide.text?.alignment || 'left',
          verticalPosition: editingSlide.text?.verticalPosition || 'center',
          showHeading: editingSlide.text?.showHeading !== undefined ? editingSlide.text.showHeading : true,
          showSubheading: editingSlide.text?.showSubheading !== undefined ? editingSlide.text.showSubheading : true,
          showDescription: editingSlide.text?.showDescription !== undefined ? editingSlide.text.showDescription : true,
          showBullets: editingSlide.text?.showBullets !== undefined ? editingSlide.text.showBullets : false,
        },
        appearance: {
          theme: editingSlide.appearance?.theme || 'charleston',
          backgroundColor: editingSlide.appearance?.backgroundColor || '#292929',
          overlayDarken: editingSlide.appearance?.overlayDarken !== undefined ? editingSlide.appearance.overlayDarken : false,
          padding: editingSlide.appearance?.padding || '2rem',
        }
      });
    }
  }, [editingSlide]);
  const [presentationSettings, setPresentationSettings] = useState({
    title: 'Presentation',
    subtitle: 'Interactive presentation for {customerName}'
  });
  
  // Function to generate a unique ID
  const generateId = () => {
    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
  };
  
  // Function to get background color based on theme
  const getThemeBackgroundColor = (theme) => {
    switch (theme) {
      case 'charleston':
        return '#2B2D2F';
      case 'emerald':
        return '#50C878';
      case 'eton':
        return '#87CEAB';
      case 'beige':
        return '#F2F0E6';
      default:
        return '#2B2D2F';
    }
  };

  // Load presentation settings from localStorage on component mount
  useEffect(() => {
    try {
      const savedSettings = localStorage.getItem('presentationSettings');
      if (savedSettings) {
        setPresentationSettings(JSON.parse(savedSettings));
      }
    } catch (error) {
      console.error('Error loading presentation settings:', error);
    }
  }, []);

  // Handle drag and drop reordering
  const handleDragEnd = (result) => {
    if (!result.destination) return;
    
    const sourceIndex = result.source.index;
    const destinationIndex = result.destination.index;
    
    if (sourceIndex !== destinationIndex) {
      dispatch(reorderSlides({ sourceIndex, destinationIndex }));
    }
  };

  // Handle adding a new slide
  const handleAddSlide = (layout) => {
    const newSlide = {
      id: `slide-${Date.now()}`,
      layout,
      media: {
        type: layout === 'video-bg-text' ? 'video' : 'image',
        urls: [layout === 'video-bg-text' ? '/videos/sample.mp4' : '/images/sample.jpg'],
        position: layout === 'media-text-split' ? 'left' : layout === 'video-bg-text' ? 'background' : 'overlap',
      },
      text: {
        heading: `New ${layout} Slide`,
        subheading: 'Click to edit',
        description: 'Edit this slide content',
        bullets: ['Feature 1', 'Feature 2', 'Feature 3'],
        alignment: 'left',
        verticalPosition: 'center',
        showBullets: true,
      },
      appearance: {
        theme: 'charleston',
        backgroundColor: '#2B2D2F',
        overlayDarken: false,
        padding: '2rem',
      },
      meta: {
        index: slides.length,
        status: 'draft',
        updatedAt: new Date().toISOString()
      }
    };
    
    dispatch(addSlide(newSlide));
  };

  // Toggle between edit and preview modes
  const togglePreviewMode = () => {
    setPreviewMode(!previewMode);
  };

  return (
    <div className="bg-[#1e1e1e] rounded-lg shadow-lg p-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-[#93cfa2]">Slide Management</h2>
        <div className="flex space-x-4">
          <button
            onClick={() => {
              // Save slides to localStorage for persistence
              localStorage.setItem('slides', JSON.stringify(slides));
              
              // Save presentation settings
              localStorage.setItem('presentationSettings', JSON.stringify(presentationSettings));
              
              // Dispatch a custom event to notify other components
              const event = new Event('slidesUpdated');
              window.dispatchEvent(event);
              
              // Also trigger a storage event for cross-tab communication
              const storageEvent = new StorageEvent('storage', {
                key: 'slides',
                newValue: JSON.stringify(slides),
                url: window.location.href
              });
              window.dispatchEvent(storageEvent);
              
              alert('Slides saved successfully! Changes will be reflected on the customer page.');
            }}
            className="px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white transition-colors"
          >
            Save Changes
          </button>
          <button
            onClick={togglePreviewMode}
            className={`px-4 py-2 rounded-md transition-colors ${
              previewMode 
                ? 'bg-[#54bb74] text-white' 
                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
            }`}
          >
            {previewMode ? 'Exit Preview' : 'Preview Slides'}
          </button>
        </div>
      </div>
      
      {/* Presentation Settings */}
      <div className="bg-[#292929] p-4 rounded-lg mb-6">
        <h3 className="text-xl font-bold text-white mb-4">Presentation Settings</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-gray-300 mb-2">Presentation Title</label>
            <input
              type="text"
              value={presentationSettings.title}
              onChange={(e) => {
                setPresentationSettings({
                  ...presentationSettings,
                  title: e.target.value
                });
                
                // Save to localStorage immediately
                setTimeout(() => {
                  localStorage.setItem('presentationSettings', JSON.stringify({
                    ...presentationSettings,
                    title: e.target.value
                  }));
                  window.dispatchEvent(new Event('slidesUpdated'));
                }, 100);
              }}
              className="w-full bg-[#1e1e1e] text-white p-2 rounded-md"
              placeholder="Presentation"
            />
          </div>
          <div>
            <label className="block text-gray-300 mb-2">Presentation Subtitle</label>
            <input
              type="text"
              value={presentationSettings.subtitle}
              onChange={(e) => {
                setPresentationSettings({
                  ...presentationSettings,
                  subtitle: e.target.value
                });
                
                // Save to localStorage immediately
                setTimeout(() => {
                  localStorage.setItem('presentationSettings', JSON.stringify({
                    ...presentationSettings,
                    subtitle: e.target.value
                  }));
                  window.dispatchEvent(new Event('slidesUpdated'));
                }, 100);
              }}
              className="w-full bg-[#1e1e1e] text-white p-2 rounded-md"
              placeholder="Interactive presentation for {customerName}"
            />
            <p className="text-xs text-gray-400 mt-1">Use customerName to insert the customer's name</p>
          </div>
        </div>
      </div>

      {/* Edit Modal */}
      {editModalOpen && editingSlide && (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-start justify-center z-50 pt-24 pb-10">
          <div className="bg-[#292929] rounded-lg p-8 w-full max-w-5xl max-h-[80vh] overflow-y-auto mt-8 mb-12">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-bold text-white">Edit Slide</h2>
              <div className="flex items-center space-x-3">
                <button
                  onClick={() => {
                    // Apply all form state changes to Redux at once
                    // This ensures all changes are saved even if some weren't triggered by onChange events
                    
                    // Update layout
                    dispatch(updateSlide({
                      id: editingSlide.id,
                      field: 'layout',
                      value: formState.layout
                    }));
                    
                    // Update media
                    dispatch(updateSlide({
                      id: editingSlide.id,
                      field: 'media',
                      value: formState.media
                    }));
                    
                    // Update text
                    dispatch(updateSlide({
                      id: editingSlide.id,
                      field: 'text',
                      value: formState.text
                    }));
                    
                    // Update appearance
                    dispatch(updateSlide({
                      id: editingSlide.id,
                      field: 'appearance',
                      value: formState.appearance
                    }));
                    
                    // Save slides to localStorage for persistence
                    localStorage.setItem('slides', JSON.stringify(slides));
                    
                    // Dispatch a custom event to notify other components
                    const event = new Event('slidesUpdated');
                    window.dispatchEvent(event);
                    
                    // Also trigger a storage event for cross-tab communication
                    const storageEvent = new StorageEvent('storage', {
                      key: 'slides',
                      newValue: JSON.stringify(slides),
                      url: window.location.href
                    });
                    window.dispatchEvent(storageEvent);
                    
                    setEditModalOpen(false);
                  }}
                  className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium"
                >
                  Save Changes
                </button>
                <button 
                  onClick={() => setEditModalOpen(false)}
                  className="text-gray-400 hover:text-white p-2 rounded-full hover:bg-[#3a3a3a] transition-colors"
                  aria-label="Close modal"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {/* Left Column - Layout & Media */}
              <div>
                <div className="mb-6">
                  <h3 className="text-lg font-medium text-white mb-3">Layout</h3>
                  <div className="grid grid-cols-3 gap-3">
                    <button
                      onClick={() => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          layout: 'media-text-split',
                          // Set default options for this layout
                          media: {
                            ...formState.media,
                            type: 'image',
                            position: 'left'
                          }
                        });
                        
                        // Update Redux state
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'layout',
                          value: 'media-text-split'
                        }));
                        
                        // Update media position to match layout
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.position',
                          value: 'left'
                        }));
                        
                        // Save to localStorage
                        setTimeout(() => {
                          localStorage.setItem('slides', JSON.stringify(slides));
                          window.dispatchEvent(new Event('slidesUpdated'));
                        }, 100);
                      }}
                      className={`p-3 rounded-md flex flex-col items-center transition-all duration-300 ${
                        formState.layout === 'media-text-split' 
                          ? 'bg-[#54bb74] text-white scale-105 shadow-lg' 
                          : 'bg-[#1e1e1e] text-gray-300 hover:bg-[#333] hover:scale-105'
                      }`}
                    >
                      <FaColumns className="text-2xl mb-2" />
                      <span className="text-sm">Media + Text</span>
                    </button>
                    <button
                      onClick={() => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          layout: 'video-background',
                          // Set default options for this layout
                          media: {
                            ...formState.media,
                            type: 'video',
                            position: 'background'
                          },
                          text: {
                            ...formState.text,
                            alignment: 'center'
                          }
                        });
                        
                        // Update Redux state
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'layout',
                          value: 'video-background'
                        }));
                        
                        // Update media type and position to match layout
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.type',
                          value: 'video'
                        }));
                        
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.position',
                          value: 'background'
                        }));
                        
                        // Save to localStorage
                        setTimeout(() => {
                          localStorage.setItem('slides', JSON.stringify(slides));
                          window.dispatchEvent(new Event('slidesUpdated'));
                        }, 100);
                      }}
                      className={`p-3 rounded-md flex flex-col items-center transition-all duration-300 ${
                        formState.layout === 'video-background' 
                          ? 'bg-[#54bb74] text-white scale-105 shadow-lg' 
                          : 'bg-[#1e1e1e] text-gray-300 hover:bg-[#333] hover:scale-105'
                      }`}
                    >
                      <FaVideo className="text-2xl mb-2" />
                      <span className="text-sm">Video Background</span>
                    </button>
                    <button
                      onClick={() => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          layout: 'image-collage',
                          // Set default options for this layout
                          media: {
                            ...formState.media,
                            type: 'multipleImages',
                            position: 'grid'
                          }
                        });
                        
                        // Update Redux state
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'layout',
                          value: 'image-collage'
                        }));
                        
                        // Update media type to match layout
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.type',
                          value: 'multipleImages'
                        }));
                        
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.position',
                          value: 'grid'
                        }));
                        
                        // Save to localStorage
                        setTimeout(() => {
                          localStorage.setItem('slides', JSON.stringify(slides));
                          window.dispatchEvent(new Event('slidesUpdated'));
                        }, 100);
                      }}
                      className={`p-3 rounded-md flex flex-col items-center transition-all duration-300 ${
                        formState.layout === 'image-collage' 
                          ? 'bg-[#54bb74] text-white scale-105 shadow-lg' 
                          : 'bg-[#1e1e1e] text-gray-300 hover:bg-[#333] hover:scale-105'
                      }`}
                    >
                      <FaLayerGroup className="text-2xl mb-2" />
                      <span className="text-sm">Image Collage</span>
                    </button>
                  </div>
                </div>
                
                <div className="mb-6">
                  <h3 className="text-lg font-medium text-white mb-3">Media</h3>
                  
                  {/* Media Type - Only show relevant options based on layout */}
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Media Type</label>
                    <select
                      value={formState.media.type}
                      onChange={(e) => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          media: {
                            ...formState.media,
                            type: e.target.value
                          }
                        });
                        
                        // Update Redux state
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'media.type',
                          value: e.target.value
                        }));
                        
                        // Save to localStorage
                        setTimeout(() => {
                          localStorage.setItem('slides', JSON.stringify(slides));
                          window.dispatchEvent(new Event('slidesUpdated'));
                        }, 100);
                      }}
                      className="w-full bg-[#1e1e1e] text-white p-2 rounded-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                      disabled={formState.layout === 'video-background' || formState.layout === 'image-collage'}
                    >
                      {/* Show options based on layout */}
                      {formState.layout === 'media-text-split' && (
                        <>
                          <option value="image">Single Image</option>
                          <option value="video">Video</option>
                        </>
                      )}
                      {formState.layout === 'video-background' && (
                        <option value="video">Video</option>
                      )}
                      {formState.layout === 'image-collage' && (
                        <option value="multipleImages">Multiple Images</option>
                      )}
                    </select>
                    {(formState.layout === 'video-background' || formState.layout === 'image-collage') && (
                      <p className="text-xs text-gray-400 mt-1">
                        {formState.layout === 'video-background' ? 'Video Background layout requires video media type' : 'Image Collage layout requires multiple images'}
                      </p>
                    )}
                  </div>
                  
                  {/* Media Position - Show different options based on layout */}
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Text Position</label>
                    {formState.layout === 'media-text-split' && (
                      <div className="grid grid-cols-2 gap-2">
                        <button
                          onClick={() => {
                            // Update local form state immediately for UI feedback
                            setFormState({
                              ...formState,
                              media: {
                                ...formState.media,
                                position: 'left'
                              }
                            });
                            
                            // Update Redux state
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'media.position',
                              value: 'left'
                            }));
                            
                            // Save to localStorage immediately
                            setTimeout(() => {
                              localStorage.setItem('slides', JSON.stringify(slides));
                              window.dispatchEvent(new Event('slidesUpdated'));
                            }, 100);
                          }}
                          className={`p-3 rounded-md flex flex-col items-center transition-all duration-300 ${
                            formState.media.position === 'left' 
                              ? 'bg-[#54bb74] text-white' 
                              : 'bg-[#1e1e1e] text-gray-300 hover:bg-[#333]'
                          }`}
                        >
                          <div className="flex items-center justify-center w-full">
                            <div className="w-1/3 h-8 bg-[#54bb74]/50 rounded-l"></div>
                            <div className="w-2/3 h-8 bg-[#333] rounded-r flex items-center justify-center">
                              <span className="text-xs">Text</span>
                            </div>
                          </div>
                          <span className="text-xs mt-1">Left</span>
                        </button>
                        
                        <button
                          onClick={() => {
                            // Update local form state immediately for UI feedback
                            setFormState({
                              ...formState,
                              media: {
                                ...formState.media,
                                position: 'right'
                              }
                            });
                            
                            // Update Redux state
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'media.position',
                              value: 'right'
                            }));
                            
                            // Save to localStorage immediately
                            setTimeout(() => {
                              localStorage.setItem('slides', JSON.stringify(slides));
                              window.dispatchEvent(new Event('slidesUpdated'));
                            }, 100);
                          }}
                          className={`p-3 rounded-md flex flex-col items-center transition-all duration-300 ${
                            formState.media.position === 'right' 
                              ? 'bg-[#54bb74] text-white' 
                              : 'bg-[#1e1e1e] text-gray-300 hover:bg-[#333]'
                          }`}
                        >
                          <div className="flex items-center justify-center w-full">
                            <div className="w-2/3 h-8 bg-[#333] rounded-l flex items-center justify-center">
                              <span className="text-xs">Text</span>
                            </div>
                            <div className="w-1/3 h-8 bg-[#54bb74]/50 rounded-r"></div>
                          </div>
                          <span className="text-xs mt-1">Right</span>
                        </button>
                      </div>
                    )}
                  </div>
                  
                  {/* Media URLs - Different UI based on layout */}
                  {formState.layout === 'image-collage' ? (
                    <div className="mb-4">
                      <label className="block text-gray-300 mb-2">Image Gallery (4-6 images recommended)</label>
                      <div className="space-y-2 max-h-64 overflow-y-auto pr-2">
                        {formState.media.urls.map((url, index) => (
                          <div key={index} className="flex items-center gap-2">
                            <input
                              type="text"
                              value={url || ''}
                              onChange={(e) => {
                                const newUrls = [...formState.media.urls];
                                newUrls[index] = e.target.value;
                                // Update local form state
                                setFormState({
                                  ...formState,
                                  media: {
                                    ...formState.media,
                                    urls: newUrls
                                  }
                                });
                                // Update Redux state
                                dispatch(updateSlide({
                                  id: editingSlide.id,
                                  field: 'media.urls',
                                  value: newUrls
                                }));
                              }}
                              className="flex-grow bg-[#1e1e1e] text-white p-2 rounded-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                              placeholder={`Image ${index + 1} URL`}
                            />
                            <button
                              onClick={() => {
                                const newUrls = [...formState.media.urls];
                                newUrls.splice(index, 1);
                                if (newUrls.length === 0) newUrls.push('');
                                // Update local form state
                                setFormState({
                                  ...formState,
                                  media: {
                                    ...formState.media,
                                    urls: newUrls
                                  }
                                });
                                // Update Redux state
                                dispatch(updateSlide({
                                  id: editingSlide.id,
                                  field: 'media.urls',
                                  value: newUrls
                                }));
                              }}
                              className="p-2 text-red-400 hover:text-red-300 transition-colors"
                              disabled={formState.media.urls.length <= 1}
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" />
                              </svg>
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <div className="mb-4">
                      <label className="block text-gray-300 mb-2">
                        {formState.media.type === 'video' ? 'Video URL' : 'Image URL'}
                      </label>
                      <input
                        type="text"
                        value={formState.media.urls[0] || ''}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          const newUrls = [...formState.media.urls];
                          newUrls[0] = e.target.value;
                          setFormState({
                            ...formState,
                            media: {
                              ...formState.media,
                              urls: newUrls
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'media.urls',
                            value: newUrls
                          }));
                        }}
                        className="w-full bg-[#1e1e1e] text-white p-2 rounded-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                        placeholder={formState.media.type === 'video' ? 'Enter video URL' : 'Enter image URL'}
                      />
                    </div>
                  )}
                  
                  {/* Placeholder for spacing */}
                  <div className="h-4"></div>
                  
                  {/* Media URLs - Different UI based on layout */}
                  {formState.layout === 'image-collage' ? (
                    <div className="mb-4">
                      <label className="block text-gray-300 mb-2">Image Gallery (Max 4 images recommended)</label>
                      <div className="space-y-2 max-h-64 overflow-y-auto pr-2">
                        {formState.media.urls.map((url, index) => (
                          <div key={index} className="flex items-center gap-2">
                            <input
                              type="text"
                              value={url || ''}
                              onChange={(e) => {
                                const newUrls = [...formState.media.urls];
                                newUrls[index] = e.target.value;
                                // Update local form state
                                setFormState({
                                  ...formState,
                                  media: {
                                    ...formState.media,
                                    urls: newUrls
                                  }
                                });
                                // Update Redux state
                                dispatch(updateSlide({
                                  id: editingSlide.id,
                                  field: 'media.urls',
                                  value: newUrls
                                }));
                              }}
                              className="flex-grow bg-[#1e1e1e] text-white p-2 rounded-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                              placeholder={`Image ${index + 1} URL`}
                            />
                            <button
                              onClick={() => {
                                const newUrls = [...formState.media.urls];
                                newUrls.splice(index, 1);
                                if (newUrls.length === 0) newUrls.push('');
                                // Update local form state
                                setFormState({
                                  ...formState,
                                  media: {
                                    ...formState.media,
                                    urls: newUrls
                                  }
                                });
                                // Update Redux state
                                dispatch(updateSlide({
                                  id: editingSlide.id,
                                  field: 'media.urls',
                                  value: newUrls
                                }));
                              }}
                              className="p-2 text-red-400 hover:text-red-300 transition-colors"
                              disabled={formState.media.urls.length <= 1}
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" />
                              </svg>
                            </button>
                          </div>
                        ))}
                        <button
                          onClick={() => {
                            // Limit to maximum 4 images
                            if (formState.media.urls.length >= 4) {
                              alert('Maximum 4 images allowed for best display');
                              return;
                            }
                            const newUrls = [...formState.media.urls, ''];
                            // Update local form state
                            setFormState({
                              ...formState,
                              media: {
                                ...formState.media,
                                urls: newUrls
                              }
                            });
                            // Update Redux state
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'media.urls',
                              value: newUrls
                            }));
                          }}
                          className="mt-2 w-full py-2 bg-[#1e1e1e] hover:bg-[#333] text-[#54bb74] rounded-md transition-colors flex items-center justify-center"
                        >
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clipRule="evenodd" />
                          </svg>
                          Add Image
                        </button>
                      </div>
                      <p className="text-xs text-gray-400 mt-1">
                        For best display, use exactly 4 images of similar dimensions
                      </p>
                    </div>
                  ) : (
                    <div className="mb-4">
                      <label className="block text-gray-300 mb-2">
                        {formState.media.type === 'video' ? 'Video URL/Thumbnail' : 'Image URL'}
                      </label>
                      <div className="flex">
                        <input
                          type="text"
                          value={formState.media.urls[0] || ''}
                          onChange={(e) => {
                            // Update local form state immediately for UI feedback
                            const newUrls = [...formState.media.urls];
                            newUrls[0] = e.target.value;
                            setFormState({
                              ...formState,
                              media: {
                                ...formState.media,
                                urls: newUrls
                              }
                            });
                            
                            // Update Redux state
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'media.urls',
                              value: newUrls
                            }));
                          }}
                          className="flex-grow bg-[#1e1e1e] text-white p-2 rounded-l-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                          placeholder={formState.media.type === 'video' ? 'Enter video URL or thumbnail image' : 'Enter image URL'}
                        />
                        <button 
                          className="bg-[#333] hover:bg-[#444] text-white px-3 rounded-r-md transition-colors"
                          onClick={() => {
                            // Open file selector or media library
                            alert('Media library feature coming soon!');
                          }}
                        >
                          Browse
                        </button>
                      </div>
                      <p className="text-xs text-gray-400 mt-1">
                        {formState.media.type === 'video' ? 
                          'For video backgrounds, provide a thumbnail image URL for best results' : 
                          'Enter image URL or upload from your library'}
                      </p>
                    </div>
                  )}
                </div>
                
                <div className="mb-6">
                  <h3 className="text-lg font-medium text-white mb-3">Appearance</h3>
                  {/* Theme Selection */}
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Theme</label>
                    <select
                      value={formState.appearance.theme}
                      onChange={(e) => {
                        const newTheme = e.target.value;
                        // Get background color based on theme
                        const newBgColor = getThemeBackgroundColor(newTheme);
                        
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          appearance: {
                            ...formState.appearance,
                            theme: newTheme,
                            backgroundColor: newBgColor
                          }
                        });
                        
                        // Update Redux state
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'appearance.theme',
                          value: newTheme
                        }));
                        
                        // Also update the background color field
                        dispatch(updateSlide({
                          id: editingSlide.id,
                          field: 'appearance.backgroundColor',
                          value: newBgColor
                        }));
                      }}
                      className="w-full bg-[#1e1e1e] text-white p-2 rounded-md transition-all duration-300 hover:border-[#54bb74] focus:border-[#54bb74] focus:ring-1 focus:ring-[#54bb74]"
                    >
                      <option value="charleston">Charleston (Dark)</option>
                      <option value="emerald">Emerald (Green)</option>
                      <option value="eton">Eton (Light Green)</option>
                      <option value="beige">Beige (Neutral)</option>
                      <option value="custom">Custom</option>
                    </select>
                    <p className="text-xs text-gray-400 mt-1">
                      Themes apply preset colors and styles
                    </p>
                  </div>
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Background Color</label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={formState.appearance.backgroundColor || ''}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            appearance: {
                              ...formState.appearance,
                              backgroundColor: e.target.value
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'appearance.backgroundColor',
                            value: e.target.value
                          }));
                        }}
                        className="flex-grow bg-[#1e1e1e] text-white p-2 rounded-md"
                        placeholder="#RRGGBB or rgba(r,g,b,a)"
                      />
                      <input 
                        type="color"
                        value={formState.appearance.backgroundColor || getThemeBackgroundColor(formState.appearance.theme)}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            appearance: {
                              ...formState.appearance,
                              backgroundColor: e.target.value
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'appearance.backgroundColor',
                            value: e.target.value
                          }));
                        }}
                        className="w-10 h-10 rounded cursor-pointer"
                      />
                    </div>
                    
                    <div className="flex items-center mb-4">
                      <input
                        type="checkbox"
                        id="overlayDarken"
                        checked={formState.appearance.overlayDarken}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            appearance: {
                              ...formState.appearance,
                              overlayDarken: e.target.checked
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'appearance.overlayDarken',
                            value: e.target.checked
                          }));
                        }}
                        className="mr-2"
                      />
                      <label htmlFor="overlayDarken" className="text-gray-300">Darken Overlay</label>
                    </div>
                  </div>
                </div>
              </div>
              
              {/* Right Column - Text Content */}
              <div>
                <div className="mb-6">
                  <h3 className="text-lg font-medium text-white mb-3">Text Content</h3>
                  
                  <div className="mb-4">
                    <div className="flex items-center mb-3">
                      <input
                        type="checkbox"
                        id="showHeading"
                        checked={formState.text.showHeading}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              showHeading: e.target.checked
                            }
                          });
                          
                          // Update Redux state
                          if (!editingSlide.text) {
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'text',
                              value: { showHeading: e.target.checked }
                            }));
                          } else {
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'text.showHeading',
                              value: e.target.checked
                            }));
                          }
                        }}
                        className="mr-2"
                      />
                      <label htmlFor="showHeading" className="text-gray-300">Show Heading</label>
                    </div>
                    
                    <input
                      type="text"
                      value={formState.text.heading}
                      onChange={(e) => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          text: {
                            ...formState.text,
                            heading: e.target.value
                          }
                        });
                        
                        // Update Redux state
                        if (!editingSlide.text) {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text',
                            value: { heading: e.target.value }
                          }));
                        } else {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.heading',
                            value: e.target.value
                          }));
                        }
                      }}
                      className="w-full bg-[#1e1e1e] text-white p-2 rounded-md"
                      placeholder="Main Heading"
                    />
                  </div>
                  
                  <div className="mb-4">
                    <div className="flex items-center mb-3">
                      <input
                        type="checkbox"
                        id="showSubheading"
                        checked={formState.text.showSubheading}
                        onChange={(e) => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              showSubheading: e.target.checked
                            }
                          });
                          
                          // Update Redux state
                          if (!editingSlide.text) {
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'text',
                              value: { showSubheading: e.target.checked }
                            }));
                          } else {
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'text.showSubheading',
                              value: e.target.checked
                            }));
                          }
                        }}
                        className="mr-2"
                      />
                      <label htmlFor="showSubheading" className="text-gray-300">Show Subheading</label>
                    </div>
                    
                    <input
                      type="text"
                      value={formState.text.subheading}
                      onChange={(e) => {
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          text: {
                            ...formState.text,
                            subheading: e.target.value
                          }
                        });
                        
                        // Update Redux state
                        if (!editingSlide.text) {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text',
                            value: { subheading: e.target.value }
                          }));
                        } else {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.subheading',
                            value: e.target.value
                          }));
                        }
                      }}
                      className="w-full bg-[#1e1e1e] text-white p-2 rounded-md"
                      placeholder="Subheading"
                    />
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Description (Max 300 characters)</label>
                    <textarea
                      value={formState.text.description}
                      onChange={(e) => {
                        // Limit to 300 characters
                        const limitedText = e.target.value.slice(0, 300);
                        
                        // Update local form state immediately for UI feedback
                        setFormState({
                          ...formState,
                          text: {
                            ...formState.text,
                            description: limitedText
                          }
                        });
                        
                        // Update Redux state
                        if (!editingSlide.text) {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text',
                            value: { description: limitedText }
                          }));
                        } else {
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.description',
                            value: limitedText
                          }));
                        }
                      }}
                      className="w-full bg-[#1e1e1e] text-white p-2 rounded-md h-24"
                      placeholder="Detailed description..."
                      maxLength={300}
                    />
                    <div className="flex justify-end">
                      <span className="text-xs text-gray-400 mt-1">
                        {formState.text.description.length}/300
                      </span>
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Text Alignment</label>
                    <div className="grid grid-cols-3 gap-2">
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              alignment: 'left'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.alignment',
                            value: 'left'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.alignment === 'left' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Left
                      </button>
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              alignment: 'center'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.alignment',
                            value: 'center'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.alignment === 'center' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Center
                      </button>
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              alignment: 'right'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.alignment',
                            value: 'right'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.alignment === 'right' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Right
                      </button>
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <label className="block text-gray-300 mb-2">Vertical Position</label>
                    <div className="grid grid-cols-3 gap-2">
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              verticalPosition: 'top'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.verticalPosition',
                            value: 'top'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.verticalPosition === 'top' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Top
                      </button>
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              verticalPosition: 'center'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.verticalPosition',
                            value: 'center'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.verticalPosition === 'center' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Center
                      </button>
                      <button
                        onClick={() => {
                          // Update local form state immediately for UI feedback
                          setFormState({
                            ...formState,
                            text: {
                              ...formState.text,
                              verticalPosition: 'bottom'
                            }
                          });
                          
                          // Update Redux state
                          dispatch(updateSlide({
                            id: editingSlide.id,
                            field: 'text.verticalPosition',
                            value: 'bottom'
                          }));
                        }}
                        className={`p-2 rounded-md ${formState.text.verticalPosition === 'bottom' ? 'bg-[#54bb74] text-white' : 'bg-[#1e1e1e] text-gray-300'}`}
                      >
                        Bottom
                      </button>
                    </div>
                  </div>
                  
                  <div className="mb-4">
                    <div className="flex items-center justify-between mb-2">
                      <label className="block text-gray-300">Bullet Points</label>
                      <div className="flex items-center">
                        <input
                          type="checkbox"
                          id="showBullets"
                          checked={formState.text.showBullets}
                          onChange={(e) => {
                            // Update local form state immediately for UI feedback
                            setFormState({
                              ...formState,
                              text: {
                                ...formState.text,
                                showBullets: e.target.checked
                              }
                            });
                            
                            // Update Redux state
                            dispatch(updateSlide({
                              id: editingSlide.id,
                              field: 'text.showBullets',
                              value: e.target.checked
                            }));
                          }}
                          className="mr-2"
                        />
                        <label htmlFor="showBullets" className="text-gray-300">Show Bullets</label>
                      </div>
                    </div>
                    
                    {formState.text.showBullets && (
                      <div>
                        <div className="space-y-2 mb-2">
                          {formState.text.bullets && formState.text.bullets.map((bullet, index) => (
                            <div key={index} className="flex items-center mb-2">
                              <input
                                type="text"
                                value={bullet || ''}
                                onChange={(e) => {
                                  // Update local form state immediately for UI feedback
                                  const newBullets = [...formState.text.bullets];
                                  newBullets[index] = e.target.value;
                                  setFormState({
                                    ...formState,
                                    text: {
                                      ...formState.text,
                                      bullets: newBullets
                                    }
                                  });
                                  
                                  // Update Redux state
                                  dispatch(updateSlide({
                                    id: editingSlide.id,
                                    field: 'text.bullets',
                                    value: newBullets
                                  }));
                                }}
                                className="w-full bg-[#1e1e1e] text-white p-2 rounded-md"
                                placeholder={`Bullet point ${index + 1}`}
                                maxLength={50}
                              />
                              <button
                                onClick={() => {
                                  // Update local form state immediately for UI feedback
                                  const newBullets = [...formState.text.bullets];
                                  newBullets.splice(index, 1);
                                  setFormState({
                                    ...formState,
                                    text: {
                                      ...formState.text,
                                      bullets: newBullets
                                    }
                                  });
                                  
                                  // Update Redux state
                                  dispatch(updateSlide({
                                    id: editingSlide.id,
                                    field: 'text.bullets',
                                    value: newBullets
                                  }));
                                }}
                                className="ml-2 text-red-400 hover:text-red-300"
                                title="Remove bullet point"
                              >
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clipRule="evenodd" />
                                </svg>
                              </button>
                            </div>
                          ))}
                          
                          {/* Add new bullet point button */}
                          {(!formState.text.bullets || formState.text.bullets.length < 6) && (
                            <button 
                              onClick={() => {
                                // Initialize bullets array if it doesn't exist
                                const currentBullets = formState.text.bullets || [];
                                const newBullets = [...currentBullets, ''];
                                
                                // Update local form state
                                setFormState({
                                  ...formState,
                                  text: {
                                    ...formState.text,
                                    bullets: newBullets
                                  }
                                });
                                
                                // Update Redux state
                                dispatch(updateSlide({
                                  id: editingSlide.id,
                                  field: 'text.bullets',
                                  value: newBullets
                                }));
                              }}
                              className="w-full bg-[#1e1e1e] text-gray-300 hover:bg-[#2a2a2a] hover:text-white p-2 rounded-md flex items-center justify-center"
                            >
                              <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clipRule="evenodd" />
                              </svg>
                              Add Bullet Point
                            </button>
                          )}
                        </div>
                        <p className="text-xs text-gray-400">Each bullet point limited to 50 characters. Maximum 6 bullet points allowed.</p>
                      </div>
                    )}
                  </div>
                
                </div>
                
                <div className="mb-6">
                  <h3 className="text-lg font-medium text-white mb-3">Slide Preview <span className="text-xs text-gray-400 ml-2">(Synced with customer view)</span></h3>
                  <div className="bg-[#1e1e1e] rounded-lg p-4 h-[400px] overflow-hidden">
                    {/* Define theme styles for preview */}
                    {(() => {
                      // Theme definitions - same as in the frontend component
                      const themeStyles = {
                        charleston: {
                          bg: '#2B2D2F',
                          text: '#FFFFFF',
                          accent: '#50C878',
                          secondaryAccent: '#93cfa2',
                          gradient: 'linear-gradient(135deg, #2B2D2F 0%, #3a3c3e 100%)',
                          buttonGradient: 'linear-gradient(to right, #50C878, #93cfa2)',
                          shadow: '0 4px 12px rgba(80, 200, 120, 0.2)',
                          borderRadius: '0.5rem',
                          headingStyle: 'font-bold tracking-tight',
                          bulletStyle: 'rounded-full bg-[#50C878]',
                          textShadow: 'none',
                          cardStyle: 'border-l-4 border-[#50C878]',
                          animation: 'fade-in-up',
                        },
                        emerald: {
                          bg: '#50C878',
                          text: '#2B2D2F',
                          accent: '#FFFFFF',
                          secondaryAccent: '#e6e6e6',
                          gradient: 'linear-gradient(135deg, #50C878 0%, #93cfa2 100%)',
                          buttonGradient: 'linear-gradient(to right, #2B2D2F, #3a3c3e)',
                          shadow: '0 4px 12px rgba(43, 45, 47, 0.2)',
                          borderRadius: '1rem',
                          headingStyle: 'font-bold italic',
                          bulletStyle: 'rounded-full bg-white',
                          textShadow: '0 1px 2px rgba(0,0,0,0.1)',
                          cardStyle: 'border-b-4 border-white',
                          animation: 'slide-in-right',
                        },
                        eton: {
                          bg: '#87CEAB',
                          text: '#2B2D2F',
                          accent: '#FFFFFF',
                          secondaryAccent: '#e6e6e6',
                          gradient: 'linear-gradient(135deg, #87CEAB 0%, #a9dbc4 100%)',
                          buttonGradient: 'linear-gradient(to right, #2B2D2F, #3a3c3e)',
                          shadow: '0 4px 12px rgba(135, 206, 171, 0.3)',
                          borderRadius: '0.75rem',
                          headingStyle: 'font-medium tracking-wide',
                          bulletStyle: 'rounded-sm bg-white',
                          textShadow: 'none',
                          cardStyle: 'border-r-4 border-white',
                          animation: 'fade-in-left',
                        },
                        beige: {
                          bg: '#F2F0E6',
                          text: '#2B2D2F',
                          accent: '#50C878',
                          secondaryAccent: '#93cfa2',
                          gradient: 'linear-gradient(135deg, #F2F0E6 0%, #e6e4da 100%)',
                          buttonGradient: 'linear-gradient(to right, #50C878, #93cfa2)',
                          shadow: '0 4px 12px rgba(0, 0, 0, 0.05)',
                          borderRadius: '0.25rem',
                          headingStyle: 'font-bold tracking-normal',
                          bulletStyle: 'rounded-full bg-[#50C878]',
                          textShadow: 'none',
                          cardStyle: 'border-t-4 border-[#50C878]',
                          animation: 'slide-in-up',
                        },
                      };
                      
                      // Get current theme
                      const theme = themeStyles[formState.appearance?.theme] || themeStyles.charleston;
                      
                      // Real-time slide preview
                      return (
                        <div className="preview-container">
                          {/* Simplified preview to fix syntax errors */}
                          <div className="bg-black/20 w-full h-full flex items-center justify-center rounded-lg overflow-hidden">
                            <div className="text-center p-4 bg-black/40 rounded-lg">
                              <h4 className="text-lg font-bold mb-2">{formState.text.heading || 'Slide Preview'}</h4>
                              <p className="text-sm mb-2">{formState.text.subheading || 'Layout: ' + formState.layout}</p>
                              <p className="text-xs">Theme: {formState.appearance.theme}</p>
                            </div>
                          </div>
                          {/* Original layout code commented out to fix syntax errors */}
                          {/* {formState.layout === 'media-text-split' && (
                            <div 
                              className="flex h-full transition-all duration-500 ease-in-out animate-fadeIn"
                              style={{
                                backgroundColor: formState.appearance?.backgroundColor || theme.bg,
                                borderRadius: theme.borderRadius,
                                boxShadow: theme.shadow,
                                overflow: 'hidden'
                              }}
                            >
                              {/* Media section with theme styling */}
                              <div 
                                className={`relative ${formState.media.position === 'left' ? 'order-1' : 'order-2'} w-1/2 h-full flex items-center justify-center transition-transform duration-500 hover:scale-[1.02]`}
                                style={{
                                  background: formState.appearance?.backgroundColor || theme.bg,
                                  borderRadius: formState.media.position === 'left' ? 
                                    `${theme.borderRadius} 0 0 ${theme.borderRadius}` : 
                                    `0 ${theme.borderRadius} ${theme.borderRadius} 0`,
                                }}
                              >
                                {formState.media.type === 'video' ? (
                                  formState.media.urls && formState.media.urls[0] ? (
                                    <div className="relative w-full h-full">
                                      <div 
                                        className="absolute inset-0 bg-center bg-cover"
                                        style={{ backgroundImage: `url(${formState.media.urls[0]})` }}
                                      ></div>
                                      <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
                                        <div className="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
                                          <div className="w-0 h-0 border-t-[8px] border-t-transparent border-l-[12px] border-l-white border-b-[8px] border-b-transparent ml-1"></div>
                                        </div>
                                      </div>
                                    </div>
                                  ) : (
                                    <div className="flex flex-col items-center justify-center">
                                      <div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center mb-2">
                                        <div className="w-0 h-0 border-t-[6px] border-t-transparent border-l-[10px] border-l-white border-b-[6px] border-b-transparent ml-1"></div>
                                      </div>
                                      <div className="text-white text-xs">Video Preview</div>
                                    </div>
                                  )
                                ) : (
                                  formState.media.urls && formState.media.urls[0] ? (
                                    <div className="relative w-full h-full">
                                      <img 
                                        src={formState.media.urls[0]} 
                                        alt="Preview" 
                                        className="w-full h-full object-cover"
                                      />
                                    </div>
                                  ) : (
                                    <div className="flex flex-col items-center justify-center">
                                      <div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center mb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                      </div>
                                      <div className="text-white text-xs">Image Preview</div>
                                    </div>
                                  )
                                )}
                                {formState.appearance?.overlayDarken && (
                                  <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-black/10"></div>
                                )}
                              </div>
                              
                              {/* Text section with theme styling */}
                              <div 
                                className={`${formState.media.position === 'left' ? 'order-2' : 'order-1'} w-1/2 p-6 flex flex-col ${formState.text.verticalPosition === 'top' ? 'justify-start' : formState.text.verticalPosition === 'bottom' ? 'justify-end' : 'justify-center'}`}
                                style={{ 
                                  background: theme.gradient,
                                  color: theme.text,
                                  textAlign: formState.text.alignment,
                                  textShadow: theme.textShadow,
                                }}
                              >
                                <div className={theme.cardStyle ? theme.cardStyle : ''}>
                                  {formState.text.showHeading && (
                                    <h4 
                                      className={`font-bold text-lg mb-2 transition-all duration-300 hover:translate-y-[-1px] ${theme.headingStyle}`}
                                    >
                                      {formState.text.heading || 'Heading'}
                                    </h4>
                                  )}
                                  {formState.text.showSubheading && (
                                    <p 
                                      className="text-md mb-2 transition-all duration-300 hover:translate-y-[-1px]"
                                      style={{ color: theme.accent }}
                                    >
                                      {formState.text.subheading || 'Subheading'}
                                    </p>
                                  )}
                                  {formState.text.showDescription && (
                                    <p className="text-sm mb-3 transition-opacity duration-300 hover:opacity-90">
                                      {formState.text.description || 'Description text'}
                                    </p>
                                  )}
                                  {formState.text.showBullets && formState.text.bullets && formState.text.bullets.length > 0 && (
                                    <ul className="text-sm space-y-2 mb-3">
                                      {formState.text.bullets.map((bullet, idx) => (
                                        <li key={idx} className="flex items-start transition-transform duration-300 hover:translate-x-1">
                                          <span 
                                            className={`w-2 h-2 mt-1.5 mr-2 rounded-full flex-shrink-0 ${theme.bulletStyle.includes('bg-') ? theme.bulletStyle : ''}`}
                                            style={!theme.bulletStyle.includes('bg-') ? { backgroundColor: theme.accent } : {}}
                                          ></span>
                                          <span>{bullet}</span>
                                        </li>
                                      ))}
                                    </ul>
                                  )}
                                  {formState.text.ctaText && (
                                    <button 
                                      className="mt-2 px-4 py-2 rounded text-sm transition-all duration-300 hover:scale-105"
                                      style={{ background: theme.buttonGradient }}
                                    >
                                      {formState.text.ctaText}
                                    </button>
                                  )}
                                </div>
                              </div>
                            </div>
                          )}
                          
                          {formState.layout === 'video-background' && (
                            <div 
                              className="relative h-full flex items-center justify-center transition-all duration-500 ease-in-out animate-fadeIn"
                              style={{
                                backgroundImage: formState.media.urls && formState.media.urls[0] ? 
                                  `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), url(${formState.media.urls[0]})` : 
                                  `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.5)), ${theme.gradient}`,
                                backgroundColor: formState.appearance?.backgroundColor || theme.bg,
                                backgroundSize: 'cover',
                                backgroundPosition: 'center',
                                backgroundRepeat: 'no-repeat',
                                borderRadius: theme.borderRadius,
                                boxShadow: theme.shadow,
                                overflow: 'hidden'
                              }}
                            >
                              {/* Video Play Button */}
                              <div className="absolute inset-0 flex items-center justify-center">
                                <div className="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
                                  <div className="w-0 h-0 border-t-[8px] border-t-transparent border-l-[12px] border-l-white border-b-[8px] border-b-transparent ml-1"></div>
                                </div>
                              </div>
                              
                              {/* Overlay for better text readability */}
                              <div 
                                className="absolute inset-0 bg-gradient-to-t from-black/70 to-black/30"
                                style={{ backdropFilter: formState.appearance?.overlayDarken ? 'blur(1px)' : 'none' }}
                              ></div>
                              
                              {/* Text Content */}
                              <div 
                                className="relative z-10 text-center p-6 transition-all duration-500 hover:scale-105"
                                style={{ 
                                  color: '#FFFFFF',
                                  textAlign: formState.text.alignment,
                                  textShadow: '0 2px 4px rgba(0,0,0,0.5)',
                                  maxWidth: '80%'
                                }}
                              >
                                <div className={`backdrop-blur-sm bg-black/40 p-6 rounded-lg ${theme.cardStyle ? theme.cardStyle : ''}`}>
                                  {formState.text.showHeading && (
                                    <h4 
                                      className={`font-bold text-xl mb-3 transition-all duration-300 hover:translate-y-[-1px] ${theme.headingStyle}`}
                                    >
                                      {formState.text.heading || 'Heading'}
                                    </h4>
                                  )}
                                  {formState.text.showSubheading && (
                                    <p 
                                      className="text-lg mb-2 transition-all duration-300 hover:translate-y-[-1px]"
                                      style={{ color: theme.accent }}
                                    >
                                      {formState.text.subheading || 'Subheading'}
                                    </p>
                                  )}
                                  {formState.text.showDescription && (
                                    <p className="text-sm mb-3 transition-opacity duration-300 hover:opacity-90">
                                      {formState.text.description || 'Description text'}
                                    </p>
                                  )}
                                  {formState.text.showBullets && formState.text.bullets && formState.text.bullets.length > 0 && (
                                    <ul className="text-sm space-y-2 text-left mb-4" style={{ listStylePosition: 'inside' }}>
                                      {formState.text.bullets.map((bullet, idx) => (
                                        <li key={idx} className="flex items-start transition-transform duration-300 hover:translate-x-1">
                                          <span 
                                            className={`w-2 h-2 mt-1.5 mr-2 rounded-full inline-block ${theme.bulletStyle.includes('bg-') ? theme.bulletStyle : ''}`}
                                            style={!theme.bulletStyle.includes('bg-') ? { backgroundColor: theme.accent } : {}}
                                          ></span>
                                          <span>{bullet}</span>
                                        </li>
                                      ))}
                                    </ul>
                                  )}
                                  {formState.text.ctaText && (
                                    <button 
                                      className="mt-3 px-6 py-2 rounded-full text-sm transition-all duration-300 hover:scale-105"
                                      style={{ background: theme.buttonGradient }}
                                    >
                                      {formState.text.ctaText}
                                    </button>
                                  )}
                                </div>
                              </div>
                            </div>
                          )}
                          
                          {formState.layout === 'video-bg-text' && (
                            <div className="relative w-full h-full transition-all duration-500 ease-in-out animate-fadeIn"
                              style={{
                                backgroundColor: formState.appearance?.backgroundColor || '#000',
                                borderRadius: theme.borderRadius,
                                boxShadow: theme.shadow,
                                overflow: 'hidden'
                              }}
                            >
                              {/* Video Background with Text Overlay */}
                              <div className="absolute inset-0 bg-black">
                                {formState.media.type === 'video' && formState.media.urls && formState.media.urls[0] ? (
                                  <div className="relative w-full h-full">
                                    <div 
                                      className="absolute inset-0 bg-center bg-cover"
                                      style={{ backgroundImage: `url(${formState.media.urls[0]})` }}
                                    ></div>
                                    <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
                                      <div className="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
                                        <div className="w-0 h-0 border-t-[8px] border-t-transparent border-l-[12px] border-l-white border-b-[8px] border-b-transparent ml-1"></div>
                                      </div>
                                    </div>
                                  </div>
                                ) : (
                                  <div className="flex items-center justify-center h-full">
                                    <div className="text-center text-white/60">
                                      <div className="mb-2">Video preview not available</div>
                                      <div className="text-xs">Enter a video URL in the media section</div>
                                    </div>
                                  </div>
                                )}
                              </div>
                              
                              {/* Centered Text Overlay */}
                              <div className="absolute inset-0 flex items-center justify-center z-10">
                                <div 
                                  className="text-center p-6 transition-all duration-500 hover:scale-105"
                                  style={{ 
                                    color: '#FFFFFF',
                                    textAlign: formState.text.alignment,
                                    textShadow: '0 2px 4px rgba(0,0,0,0.5)',
                                    maxWidth: '80%'
                                  }}
                                >
                                  <div className={`backdrop-blur-sm bg-black/40 p-6 rounded-lg ${theme.cardStyle ? theme.cardStyle : ''}`}>
                                    {formState.text.showHeading && (
                                      <h4 
                                        className={`font-bold text-xl mb-3 transition-all duration-300 hover:translate-y-[-1px] ${theme.headingStyle}`}
                                      >
                                        {formState.text.heading || 'Heading'}
                                      </h4>
                                    )}
                                    {formState.text.showSubheading && (
                                      <p 
                                        className="text-lg mb-2 transition-all duration-300 hover:translate-y-[-1px]"
                                        style={{ color: theme.accent }}
                                      >
                                        {formState.text.subheading || 'Subheading'}
                                      </p>
                                    )}
                                    {formState.text.showDescription && (
                                      <p className="text-sm mb-3 transition-opacity duration-300 hover:opacity-90">
                                        {formState.text.description || 'Description text'}
                                      </p>
                                    )}
                                    {formState.text.showBullets && formState.text.bullets && formState.text.bullets.length > 0 && (
                                      <ul className="text-sm list-disc pl-4 space-y-1 text-left">
                                        {formState.text.bullets.map((bullet, idx) => (
                                          <li key={idx} className="flex items-start">
                                            <span className={`w-1 h-1 mt-1 mr-1 rounded-full flex-shrink-0 ${theme.bulletStyle.includes('bg-') ? theme.bulletStyle : ''}`}
                                              style={!theme.bulletStyle.includes('bg-') ? { backgroundColor: theme.accent } : {}}
                                            ></span>
                                            <span>{bullet}</span>
                                          </li>
                                        ))}
                                      </ul>
                                    )}
                                    {formState.text.ctaText && (
                                      <button 
                                        className="mt-3 px-4 py-2 rounded text-sm transition-all duration-300 hover:scale-105"
                                        style={{ background: theme.buttonGradient }}
                                      >
                                        {formState.text.ctaText}
                                      </button>
                                    )}
                                  </div>
                                </div>
                              </div>
                            </div>
                          )}
                          
                          {formState.layout === 'media-text-split' && (
                            <div className="flex h-full">
                              <div className="w-full h-full relative">
                                {formState.media.type === 'image' && formState.media.urls && formState.media.urls[0] ? (
                                  <div 
                                    className="absolute inset-0 bg-center bg-cover"
                                    style={{ backgroundImage: `url(${formState.media.urls[0]})` }}
                                  ></div>
                                ) : (
                                  <div className="flex items-center justify-center h-full">
                                    <div className="text-center text-white/60">
                                      <div className="mb-2">Image preview not available</div>
                                      <div className="text-xs">Enter an image URL in the media section</div>
                                    </div>
                                  </div>
                                )}
                              </div>
                              <div className="w-full h-full bg-[#292929] p-6">
                                {formState.text.showHeading && (
                                  <h4 className={`font-bold text-lg mb-1 ${theme.headingStyle}`}>
                                    {formState.text.heading || 'Heading'}
                                  </h4>
                                )}
                                {formState.text.showSubheading && (
                                  <p className="text-sm mb-1" style={{ color: theme.accent }}>
                                    {formState.text.subheading || 'Subheading'}
                                  </p>
                                )}
                                {formState.text.showDescription && (
                                  <p className="text-xs mb-2">
                                    {formState.text.description || 'Description text goes here...'}
                                  </p>
                                )}
                                {formState.text.showBullets && formState.text.bullets && formState.text.bullets.length > 0 && (
                                  <ul className="text-xs list-disc pl-4 space-y-1">
                                    {formState.text.bullets.map((bullet, idx) => (
                                      <li key={idx} className="flex items-start">
                                        <span className={`w-1 h-1 mt-1 mr-1 rounded-full flex-shrink-0 ${theme.bulletStyle.includes('bg-') ? theme.bulletStyle : ''}`}
                                          style={!theme.bulletStyle.includes('bg-') ? { backgroundColor: theme.accent } : {}}
                                        ></span>
                                        <span>{bullet}</span>
                                      </li>
                                    ))}
                                  </ul>
                                )}
                                {formState.text.ctaText && (
                                  <button className="mt-2 text-xs px-2 py-1 rounded"
                                    style={{ background: theme.buttonGradient, color: theme.bg === '#FFFFFF' ? '#2B2D2F' : '#FFFFFF' }}>
                                    {formState.text.ctaText}
                                  </button>
                                )}
                                    <p className="text-sm mb-1" style={{ color: theme.accent }}>
                                      {formState.text.subheading || 'Subheading'}
                                    </p>
                                  )}
                                  {formState.text.showDescription && (
                                    <p className="text-xs mb-2">
                                      {formState.text.description || 'Description text goes here...'}
                                    </p>
                                  )}
                                  {formState.text.showBullets && formState.text.bullets && formState.text.bullets.length > 0 && (
                                    <ul className="text-xs list-disc pl-4 space-y-1">
                                      {formState.text.bullets.map((bullet, idx) => (
                                        <li key={idx} className="flex items-start">
                                          <span className={`w-1 h-1 mt-1 mr-1 rounded-full flex-shrink-0 ${theme.bulletStyle.includes('bg-') ? theme.bulletStyle : ''}`}
                                            style={!theme.bulletStyle.includes('bg-') ? { backgroundColor: theme.accent } : {}}
                                          ></span>
                                          <span>{bullet}</span>
                                        </li>
                                      ))}
                                    </ul>
                                  )}
                                  {formState.text.ctaText && (
                                    <button className="mt-2 text-xs px-2 py-1 rounded"
                                      style={{ background: theme.buttonGradient, color: theme.bg === '#FFFFFF' ? '#2B2D2F' : '#FFFFFF' }}>
                                      {formState.text.ctaText}
                                    </button>
                                  )}
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            
              {/* Bottom padding */}
              <div className="h-6"></div>
            </div>
    
      
      )}
      
      {previewMode ? (
        <div className="mb-8">
          <h3 className="text-xl font-bold mb-4 text-white">Slide Preview</h3>
          <div className="bg-black rounded-lg overflow-hidden shadow-lg">
            <SlideCarousel />
          </div>
        </div>
      ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Slide List */}
          <div className="bg-[#292929] p-4 rounded-lg">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-white">Slides</h3>
              <div className="relative">
                <div className="flex space-x-2">
                  <button 
                    onClick={() => handleAddSlide('MediaTextSplit')}
                    className="bg-[#54bb74] hover:bg-[#93cfa2] text-white px-3 py-2 rounded-md flex items-center"
                  >
                    <FaColumns className="mr-2" /> Add Media + Text
                  </button>
                  <button 
                    onClick={() => handleAddSlide('VideoBackground')}
                    className="bg-[#54bb74] hover:bg-[#93cfa2] text-white px-3 py-2 rounded-md flex items-center"
                  >
                    <FaVideo className="mr-2" /> Add Video Slide
                  </button>
                  <button 
                    onClick={() => handleAddSlide('ImageCollage')}
                    className="bg-[#54bb74] hover:bg-[#93cfa2] text-white px-3 py-2 rounded-md flex items-center"
                  >
                    <FaLayerGroup className="mr-2" /> Add Collage
                  </button>
                </div>
              </div>
            </div>

            {/* Slide List with manual reordering */}
            <div className="space-y-2">
              {slides.map((slide, index) => (
                <div
                  key={slide.id}
                  className={`p-3 rounded-md flex justify-between items-center ${
                    activeSlideIndex === index
                      ? 'bg-[#54bb74]/20 border border-[#54bb74]'
                      : 'bg-[#1e1e1e] hover:bg-[#333]'
                  }`}
                  onClick={() => dispatch(setActiveSlideIndex(index))}
                >
                  <div className="flex items-center">
                    <div className="flex flex-col mr-2">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          if (index > 0) {
                            dispatch(reorderSlides({ sourceIndex: index, destinationIndex: index - 1 }));
                          }
                        }}
                        className="text-gray-400 hover:text-white p-1"
                        disabled={index === 0}
                        title="Move up"
                      >
                        <FaArrowUp className={index === 0 ? 'opacity-30' : ''} />
                      </button>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          if (index < slides.length - 1) {
                            dispatch(reorderSlides({ sourceIndex: index, destinationIndex: index + 1 }));
                          }
                        }}
                        className="text-gray-400 hover:text-white p-1"
                        disabled={index === slides.length - 1}
                        title="Move down"
                      >
                        <FaArrowDown className={index === slides.length - 1 ? 'opacity-30' : ''} />
                      </button>
                    </div>
                    <div>
                      <h4 className="font-medium text-white">
                        {slide.title || `Slide ${index + 1}`}
                      </h4>
                      <p className="text-sm text-gray-400">{slide.layout}</p>
                    </div>
                  </div>
                  <div className="flex space-x-2">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        // Set the current slide as the editing slide and open the modal
                        setEditingSlide(slide);
                        setEditModalOpen(true);
                      }}
                      className="text-blue-400 hover:text-blue-300 mr-2"
                      title="Edit slide"
                    >
                      <FaEdit />
                    </button>
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        dispatch(removeSlide(slide.id));
                      }}
                      className="text-red-400 hover:text-red-300"
                      title="Delete slide"
                    >
                      <FaTrash />
                    </button>
                  </div>
                </div>
              ))}
            </div>

            {slides.length === 0 && (
              <div className="text-center py-8 text-gray-400">
                <p>No slides yet. Add your first slide!</p>
              </div>
            )}
          </div>

          {/* Slide Editor */}
          <div className="lg:col-span-2 bg-[#292929] p-4 rounded-lg">
            <h3 className="text-xl font-bold mb-4 text-white">Edit Slide</h3>
            {slides.length > 0 ? (
              <SlideEditor />
            ) : (
              <div className="text-center py-12 text-gray-400">
                <p>Select a slide to edit or create a new one</p>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
